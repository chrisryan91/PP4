{% extends 'base.html' %} {% block content %}

{% load crispy_forms_tags %}
<div class="masthead">
    <div class="container2">
        <div class="row g-0">
            <div class="col-md-6 masthead-text">
                <h1 class="post-title">{{ review.title }}</h1>
                <div>
                    <div>
                        {% if user.is_authenticated %}
                            <form class="d-inline" action="{% url 'review_upvote' review.slug %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="upvote" value="1">
                                <button type="submit" class="{% if user_has_upvoted %}upvoted{% endif %}">
                                    {% if user_has_upvoted %}
                                        <i class="far fa-thumbs-up"></i>
                                    {% else %}
                                        <i class="fas fa-thumbs-up"></i>
                                    {% endif %}
                                </button>
                            </form>
                            <form class="d-inline" action="{% url 'review_upvote' review.slug %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="upvote" value="0">
                                <button type="submit" class="{% if user_has_downvoted %}downvoted{% endif %}">
                                    {% if user_has_downvoted %}
                                        <i class="far fa-thumbs-down"></i>
                                    {% else %}
                                        <i class="fas fa-thumbs-down"></i>
                                    {% endif %}
                                </button>
                            </form>
                            <span>{{ review.net_votes }}</span>
                        {% else %}
                            <!-- Display total upvotes and downvotes without forms -->
                            <i class="fas fa-thumbs-up"></i>
                            <i class="fas fa-thumbs-down"></i>
                            <span>{{  review.net_votes  }}</span>
                        {% endif %}
                    </div>
                    <div>
                        <span id="like-count">{{ review. }}</span>
                    </div>
                </div>
                <h2 class="post-subtitle">
                    {{ review.author }}
                </h2>
                <h3>
                    {{ review.created_on }}
                </h3>         
                {% if user.is_authenticated and user == review.author %}
                <a href="{% url 'update_review' slug=review.slug %}">Update Review</a>
                {% endif %}
            </div>
            <div class="col-md-6 masthead-image">
                <div class="img-container">
                    {% if "placeholder" in review.featured_image.url %}
                    <img src="https://media.istockphoto.com/id/1134020110/vector/cutlery-restaurant-icons.jpg?s=612x612&w=0&k=20&c=udrCAY1Ru_iLEdwJK_fyuHXNQoH3y47ZCuNIr7uRwR0=" width="100%">
                    {% else %}
                    <img src="{{ review.featured_image.url }}" width="100%">
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="container2">
        <div  class="row g-0" >
            <div class="col-md-6 masthead-text">
                <div>
                    <h2>Ingredients:</h2>
                    <ul>
                        {% for ingredient in ingredients %}
                            <li>{{ ingredient.name }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col-md-6 masthead-text">
                <h2>Utensils:</h2>
                <ul>
                    {% for utensil in utensils %}
                        <li>{{ utensil.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <hr>
    <div class="container2">
        <h2>Review:</h2>
        <p>
            {{ review.content | safe }}
        </p>
    </div>
    <hr>
</div>
<div class="masthead">
    <div class="container2">
        <div class="row">
            <div class="col-md-8 card mb-4 mt-3">
                <h3>Comments:</h3>
                    <div class="card-body">
                        {% for comment in comments %}
                            <div class="comments" style="padding: 10px;">
                                <p class="font-weight-bold">
                                    {{ comment.name }}
                                    <span class="text-muted font-weight-normal">
                                        {{ comment.created_on }}
                                    </span> wrote:
                                </p>
                                {{ comment.body | linebreaks }}
                            </div>
                        {% endfor %}
                    </div>
            </div>
        </div>
            <div class="col-md-4 card mb-4  mt-3 ">
                <div class="card-body">
                    {% if commented %}
                    <div class="alert alert-success" role="alert">
                        Awaiting approval
                    </div>
                    {% else %}
                    {% if user.is_authenticated %}
                    <h3>Leave a comment:</h3>
                    <p>Posting as: <strong>{{ user.username }}</strong></p>
                    <form method="post">
                        {{ comment_form | crispy }}
                        {% csrf_token %}
                        <button type="submit">Submit</button>
                    </form>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
</div>

{% endblock content %}