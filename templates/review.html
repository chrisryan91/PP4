{% extends 'base.html' %} {% block content %}

{% load crispy_forms_tags %}
<div class="masthead">
    <div class="container2">
        <div class="row g-0">
            <div class="col-md-4 masthead-text">
                <div class="details">
                    <div class="details1">
                        <h1 class="post-title">{{ review.title }} | {{ review.author }}</h1>
                        <div class="voting-section">
                            <div class="user-actions">
                                {% if user.is_authenticated %}
                                    <form class="d-inline" action="{% url 'review_upvote' review.slug %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="vote_type" value="upvote">
                                        {% if liked %}
                                        <button type="submit" name="review_id" value="{{ review.slug }}" id="btn-like" class="btn-like">
                                                <i class="far fa-thumbs-up upvoted"></i>
                                        </button>
                                            {% else %}
                                        <button type="submit" name="review_id" value="{{ review.slug }}" id="btn-like" class="btn-like">
                                                <i class="far fa-thumbs-up"></i>
                                        </button>
                                            {% endif %}
                                    </form>
                                    <form class="d-inline" action="{% url 'review_upvote' review.slug %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="vote_type" value="downvote">
                                            {% if disliked %}
                                            <button type="submit" name="blog_id" value="{{ review.slug }}" id="btn-like" class="btn-like">
                                                <i class="far fa-thumbs-down downvoted"></i>
                                            </button>
                                            {% else %}
                                            <button type="submit" name="blog_id" value="{{ review.slug }}" id="btn-like" class="btn-like">
                                                <i class="far fa-thumbs-down"></i>
                                            </button>
                                            {% endif %}
                                    </form>
                                {% else %}
                                    <i class="fas fa-thumbs-up"></i>
                                    <i class="fas fa-thumbs-down"></i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="details2">
                        <h1>Upvotes: {{ review.total_votes }} </h1>
                        <h1>Prep time: {{ review.prep_time }} minutes</h1>
                        <p>{{ review.excerpt }}... </p>
                    </div>
                    <div class="details3">Link to original recipe - <strong>{{ review.recipe }}</strong>- to be found <a href="{{ review.url }}"><u>here!</u></a></div>
                </div>
            </div>
            <div class="col-md-4 masthead-image">
                <div class="utensils">
                    <h2>Utensils:</h2>
                    <ul>
                        {% for utensil in utensils %}
                            <li>{{ utensil.name }}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="ingredients">            
                    <h2>Ingredients:</h2>
                    <ul>
                        {% for ingredient in ingredients %}
                            <li>{{ ingredient.name }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col-md-4 masthead-image">
                <div class="img-container">
                    {% if "placeholder" in review.featured_image_a.url %}
                        <object data="{{ review.featured_image_b }}" type="image/png">
                            <img src="https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg" alt="Kitties">
                        </object>
                    {% else %}
                        <img src="{{ review.featured_image_a.url }}" width="100%">
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="container2">
        <div class="row g-0" >
            <h2>Review:</h2>
            <div id="review">
                <p>
                    {{ review.content | safe }}
                </p>
                <span>
                    <h3>
                        {{ review.created_on }} | {% if user.is_authenticated and user == review.author %}<a href="{% url 'update_review' slug=review.slug %}">Update Review</a>{% endif %}
                    </h3>
                </span>
            </div>
        </div>
    </div>
    <hr>
</div>
<div class="masthead">
    <div class="container2">
        <div class="row">
            <div class="col-md-8 card mb-4 mt-3" id="comments">
                <h1>Comments:</h1>
                {% if comments %}
                    <div class="card-body1">
                        {% for comment in comments %}
                            <div class="comments" style="padding-top: 10px;">
                                <h4 class="font-weight-bold">
                                    <strong>{{ comment.name }}</strong> wrote:
                                </h4>
                                <p>{{ comment.body | linebreaks }}</p>
                                <span2 class="text-muted font-weight-normal">
                                    <strong></strong>{{ comment.created_on }}
                                </span2> 
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="col-md-4 card mb-4  mt-3 " id="leavecomment">
                {% if commented %}
                    <div class="alert alert-success" role="alert">
                        Awaiting approval
                    </div>
                {% endif %}
                {% if user.is_authenticated %}
                    <div>
                        <h3>Leave a comment:</h3>
                        <p>Posting as: <strong>{{ user.username }}</strong></p>
                        <form method="post">
                            {{ comment_form | crispy }}
                            {% csrf_token %}
                            <button type="submit">Submit</button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>
{% endblock content %}